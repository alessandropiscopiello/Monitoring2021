#THE EFFECTS OF XYLELLA OUTBREAK ON APULIA ECOSYSTEM 

#THIS PROJECT AIMS TO :
#ASSESS THE SEVERITY OF THE XYLELLA OUTBREAK ON VEGETATION AND ECOSYSTEM OF APULIA REGION:
#understand the consequences on olive trees (most of the Salento tree vegetation)
#understand the consequences of the fires during the last summer (2020)


# to read the copernicus data I have to install a package and to use "" in order to let R know to import them since they are external.
install.packages("ncdf4") 
#to recall the package installed, I need to use the function library 
library(ncdf4)

#I'm going to install also ggplot2 in order to create graphics 
install.packages("ggplot2")
#and recall the package using the function library
library(ggplot2)

#Another package useful for this analysis is RStoolbox that is used for remote sensing image processing 
install.packages("RStoolbox")
library(RStoolbox)

# Since data are saved in pixels need to install raster package too. In the spatial world, each pixel represents an area on the Earth's surface.
install.packages("raster")
library(raster)
#CHANGES IN NDVI (DIC 2014-FEB 2021)

#Setting the working directory and uploading the data
setwd("c:/lab/")
ndvi2014<-raster("c_gls_NDVI300_201412010000_GLOBE_PROBAV_V1.0.1.nc")
ndvi2014 #to check for the extension
ndvi2021<-raster("c_gls_NDVI300_202101010000_GLOBE_OLCI_V2.0.1.nc")
ndvi 2021 #to check for the extension

#Cropping Salento region (and something more, of course)
ext <- c(16.58,18.62,39.71,41.35)  #establish the extent
ndvi2014 <- crop(ndvi2014, ext)
ndvi2021 <- crop(ndvi2021, ext)


#changing the colors using those from the "greenbrown" package. See more at: https://rdrr.io/rforge/greenbrown/src/R/brgr.colors.R
NC <- colorRampPalette(c("chocolate4", "orange", "yellow", "grey", "green", "forestgreen", "darkgreen"))(100)

#plotting the images together using the par function
jpeg('ndvi_2014-2021.jpg') #to save the image, but it's too small, so from now on I will save images with "print on PDF" function and then convert in image
par(mfrow=c(1,2))
plot(ndvi2014, col=NC, main="NDVI 2014")
plot(ndvi2021, col=NC, main="NDVI 2021")

dev.off() to close the graphic plot

#difference between NDVI: jan2021 - jan2014
NDVIdiff <- ndvi2014 - ndvi2021 
plot(NDVIdiff, col=NC, main= "Difference in NDVI between 2014 and 2021")

dev.off() 

#plotting all the images together an saving it
par(mfrow=c(1,3))
plot(ndvi2014, col=NC, main="NDVI 2014")
plot(ndvi2021, col=NC, main="NDVI 2021")
plot(NDVIdiff, col=NC, main= "Difference in NDVI between 2014 and 2021")

dev.off() 

#i'm not so entusiast by the NDVI result, so I try to see what happen with Fcover index
#FCover 2014-2020 (last year available)

#importing the data
Fcov2014 <- raster("c_gls_FCOVER300_201401100000_GLOBE_PROBAV_V1.0.1.nc")
Fcov2020 <- raster("c_gls_FCOVER300_202001100000_GLOBE_PROBAV_V1.0.1.nc")

#Cropping Salento region 
ext <- c(16.58,18.62,39.71,41.35) 
Fcov2014 <- crop(Fcov2014, ext)
Fcov2020 <- crop(Fcov2020, ext)

#plotting the images, changing the palette using HEX codes and saving them
CLF <- colorRampPalette(c('#ADFF2F', '#7FFF00', '#32CD32', '#228B22', '#008000', '#006400'))(100)
par(mfrow=c(1,2))
plot(Fcov2014, col=CLF, main="FCover 2014")
plot(Fcov2020, col=CLF, main="FCover 2020")

dev.off()

#difference between FCover: jan2020 - jan2014, but I want to change the color palette first
CLF2 <- colorRampPalette(c('#B2182B','#D6604D','#F4A582','#FDDBC7','#D1E5F0','#92C5DE','#4393C3','#2166AC'))(100)
CovDIFF <- Fcov2020 - Fcov2014
plot(CovDIFF, col= CLF2, main = "Difference in FCover between 2014 and 2020")

#plotting all the images together an saving it
par(mfrow=c(1,3))
plot(Fcov2014, col=CLF, main="FCover 2014")
plot(Fcov2020, col=CLF, main="FCover 2020")
plot(CovDIFF, col= CLF2, main = "Difference in FCover between 2014 and 2020")


dev.off()

#histogram 
hist(CovDIFF, col="limegreen", xlab="FCover change", main= "FCover histogram")
#Now I make use of stack function to transform data available as separate columns in a data frame, namely i put togheter a number of layer
FCOVER <- stack(Fcov2014, Fcov2020)
plot(FCOVER)
boxplot(FCOVER,vertical=T,axes=T,outline=F, col="limegreen",ylab="FCOVER", xlab="Year", main="FCover Boxplot")

#plotting histogram and boxplot together, then saving it
par(mfrow=c(1,2))
hist(CovDIFF, col="limegreen", xlab="FCover change", main= "FCover histogram")
boxplot(FCOVER,vertical=T,axes=T,outline=F, col="limegreen",ylab="FCOVER", xlab="Year", main="FCover Boxplot")





